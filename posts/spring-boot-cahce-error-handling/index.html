<!DOCTYPE html><html lang="ko" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Spring Boot에서 CacheManager를 에러 핸들링하는 방법" /><meta property="og:locale" content="ko" /><meta name="description" content="본 글은 아래 링크의 글의 내용과 이어집니다." /><meta property="og:description" content="본 글은 아래 링크의 글의 내용과 이어집니다." /><link rel="canonical" href="https://choieungi.github.io/posts/spring-boot-cahce-error-handling/" /><meta property="og:url" content="https://choieungi.github.io/posts/spring-boot-cahce-error-handling/" /><meta property="og:site_name" content="Ruggy Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-03-31T11:22:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Spring Boot에서 CacheManager를 에러 핸들링하는 방법" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-04-01T00:04:28+09:00","datePublished":"2024-03-31T11:22:00+09:00","description":"본 글은 아래 링크의 글의 내용과 이어집니다.","headline":"Spring Boot에서 CacheManager를 에러 핸들링하는 방법","mainEntityOfPage":{"@type":"WebPage","@id":"https://choieungi.github.io/posts/spring-boot-cahce-error-handling/"},"url":"https://choieungi.github.io/posts/spring-boot-cahce-error-handling/"}</script><title>Spring Boot에서 CacheManager를 에러 핸들링하는 방법 | Ruggy Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ruggy Blog"><meta name="application-name" content="Ruggy Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://avatars.githubusercontent.com/u/70755947?v=4 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ruggy Blog</a></div><div class="site-subtitle font-italic">Growth Process as Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/choieungi" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/eungi-choi-a8565620b" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['choieungi','gm.gist.ac.kr'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Spring Boot에서 CacheManager를 에러 핸들링하는 방법</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Spring Boot에서 CacheManager를 에러 핸들링하는 방법</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/Choieungi">Eungi, Choi</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1711851720" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-03-31 </em> </span> <span> Updated <em class="timeago" data-ts="1711897468" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-04-01 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2186 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><p>본 글은 아래 링크의 글의 내용과 이어집니다.</p><ul><li><a href="https://choieungi.github.io/posts/spring-redis-cache-serialization-exception">https://choieungi.github.io/posts/spring-redis-cache-serialization-exception</a></ul><p>Spring에서 제공하는 <code class="language-plaintext highlighter-rouge">@Cacheable</code>을 이용하면 캐쉬를 AOP 기반으로 쉽게 사용할 수 있습니다. <a href="https://choieungi.github.io/posts/spring-redis-cache-serialization-exception/">이전 글</a>에서 다뤘듯, 기본적으로 <code class="language-plaintext highlighter-rouge">@Cacheable</code> 을 실행하는 Aspect 메소드에서 예외가 발생하면 전체 메소드 자체가 실패하게 됩니다. 해당 상황에서 에러 핸들링을 통해 특정 상황에서 Exception이 발생하지 않도록 변경하는 방법을 소개합니다.</p><h3 id="cacheable-의-cacheerrorhandler-동작-원리"><span class="mr-2"><code class="language-plaintext highlighter-rouge"><span class="mr-2">@Cacheable</code> 의 <code class="language-plaintext highlighter-rouge"><span class="mr-2">CacheErrorHandler</code> 동작 원리</span><a href="#cacheable-의-cacheerrorhandler-동작-원리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><a href="https://docs.spring.io/spring-framework/docs/4.1.x/spring-framework-reference/html/cache.html#:~:text=By%20default%2C%20any%20exception%20throw%20during%20a%20cache%20related%20operations%20are%20thrown%20back%20at%20the%20client">Spring 문서</a>에 따르면 Error Handler는 <code class="language-plaintext highlighter-rouge">SimpleCacheErrorHandler</code>를 기본 값으로 사용하고 있으며 기본적으로 에러를 클라이언트에 직접 반환합니다.<code class="language-plaintext highlighter-rouge">SimpleCacheErrorHandler</code> 코드는 다음과 같습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">// package org.springframework.cache.interceptor;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleCacheErrorHandler</span> <span class="kd">implements</span> <span class="nc">CacheErrorHandler</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleCacheGetError</span><span class="o">(</span><span class="nc">RuntimeException</span> <span class="n">exception</span><span class="o">,</span> <span class="nc">Cache</span> <span class="n">cache</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">throw</span> <span class="n">exception</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleCachePutError</span><span class="o">(</span><span class="nc">RuntimeException</span> <span class="n">exception</span><span class="o">,</span> <span class="nc">Cache</span> <span class="n">cache</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">key</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">throw</span> <span class="n">exception</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleCacheEvictError</span><span class="o">(</span><span class="nc">RuntimeException</span> <span class="n">exception</span><span class="o">,</span> <span class="nc">Cache</span> <span class="n">cache</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">throw</span> <span class="n">exception</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleCacheClearError</span><span class="o">(</span><span class="nc">RuntimeException</span> <span class="n">exception</span><span class="o">,</span> <span class="nc">Cache</span> <span class="n">cache</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">throw</span> <span class="n">exception</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>해당 ErrorHandler를 <code class="language-plaintext highlighter-rouge">CachingConfigurer</code> 에 대한 구현체 중 <code class="language-plaintext highlighter-rouge">errorHandler()</code> 의 리턴값으로 등록하면 됩니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1">// package org.springframework.cache.annotation;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CachingConfigurer</span> <span class="o">{</span>

  <span class="o">...</span>
  
	<span class="nd">@Nullable</span>
	<span class="k">default</span> <span class="nc">CacheManager</span> <span class="nf">cacheManager</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="o">...</span>

	<span class="nd">@Nullable</span>
	<span class="k">default</span> <span class="nc">CacheErrorHandler</span> <span class="nf">errorHandler</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">CachingConfigurer</code> 를 빈으로 등록하면 spring-context에서에서 기본 빈으로 등록되는 <code class="language-plaintext highlighter-rouge">AbstractCachingConfiguration</code> 로 인해 등록되게 됩니다. 코드는 다음과 같습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="c1">// package org.springframework.cache.annotation;</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="n">proxyBeanMethods</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractCachingConfiguration</span> <span class="kd">implements</span> <span class="nc">ImportAware</span> <span class="o">{</span>

	<span class="nd">@Nullable</span>
	<span class="kd">protected</span> <span class="nc">AnnotationAttributes</span> <span class="n">enableCaching</span><span class="o">;</span>

	<span class="nd">@Nullable</span>
	<span class="kd">protected</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">CacheManager</span><span class="o">&gt;</span> <span class="n">cacheManager</span><span class="o">;</span>

	<span class="nd">@Nullable</span>
	<span class="kd">protected</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">CacheResolver</span><span class="o">&gt;</span> <span class="n">cacheResolver</span><span class="o">;</span>

	<span class="nd">@Nullable</span>
	<span class="kd">protected</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">KeyGenerator</span><span class="o">&gt;</span> <span class="n">keyGenerator</span><span class="o">;</span>

	<span class="nd">@Nullable</span>
	<span class="kd">protected</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">CacheErrorHandler</span><span class="o">&gt;</span> <span class="n">errorHandler</span><span class="o">;</span>

  <span class="o">...</span>

	<span class="nd">@Autowired</span>
	<span class="kt">void</span> <span class="nf">setConfigurers</span><span class="o">(</span><span class="nc">ObjectProvider</span><span class="o">&lt;</span><span class="nc">CachingConfigurer</span><span class="o">&gt;</span> <span class="n">configurers</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">CachingConfigurer</span><span class="o">&gt;</span> <span class="n">configurer</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="nc">List</span><span class="o">&lt;</span><span class="nc">CachingConfigurer</span><span class="o">&gt;</span> <span class="n">candidates</span> <span class="o">=</span> <span class="n">configurers</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
			<span class="k">if</span> <span class="o">(</span><span class="nc">CollectionUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">candidates</span><span class="o">))</span> <span class="o">{</span>
				<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">candidates</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">candidates</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">" implementations of "</span> <span class="o">+</span>
						<span class="s">"CachingConfigurer were found when only 1 was expected. "</span> <span class="o">+</span>
						<span class="s">"Refactor the configuration such that CachingConfigurer is "</span> <span class="o">+</span>
						<span class="s">"implemented only once or not at all."</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">return</span> <span class="n">candidates</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
		<span class="o">};</span>
		<span class="n">useCachingConfigurer</span><span class="o">(</span><span class="k">new</span> <span class="nc">CachingConfigurerSupplier</span><span class="o">(</span><span class="n">configurer</span><span class="o">));</span>
	<span class="o">}</span>

</pre></table></code></div></div><p>실제로 <code class="language-plaintext highlighter-rouge">setConfigurers()</code>에 <code class="language-plaintext highlighter-rouge">@Autowired</code> 를 이용해 setter Injection을 통해 의존성 주입을 진행해주게 됩니다.여기서 <code class="language-plaintext highlighter-rouge">CachingConfigurer</code>를 추가로 빈으로 등록하지 않는다면, <code class="language-plaintext highlighter-rouge">@Cacheable</code> 이 실제로 동작하는 <code class="language-plaintext highlighter-rouge">CacheAspectSupport</code> 에서 초기화 할 때 기본값인 <code class="language-plaintext highlighter-rouge">SimpleCacheErrorHandler</code>가 등록되게 됩니다. 관련 코드는 다음과 같습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">// package org.springframework.cache.interceptor;</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">CacheAspectSupport</span> <span class="kd">extends</span> <span class="nc">AbstractCacheInvoker</span>
		<span class="kd">implements</span> <span class="nc">BeanFactoryAware</span><span class="o">,</span> <span class="nc">InitializingBean</span><span class="o">,</span> <span class="nc">SmartInitializingSingleton</span> <span class="o">{</span>
		
		<span class="o">...</span>
		
		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span>
					<span class="nd">@Nullable</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">CacheErrorHandler</span><span class="o">&gt;</span> <span class="n">errorHandler</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">KeyGenerator</span><span class="o">&gt;</span> <span class="n">keyGenerator</span><span class="o">,</span>
					<span class="nd">@Nullable</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">CacheResolver</span><span class="o">&gt;</span> <span class="n">cacheResolver</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">CacheManager</span><span class="o">&gt;</span> <span class="n">cacheManager</span><span class="o">)</span> <span class="o">{</span>
		
				<span class="k">this</span><span class="o">.</span><span class="na">errorHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SingletonSupplier</span><span class="o">&lt;&gt;(</span><span class="n">errorHandler</span><span class="o">,</span> <span class="nl">SimpleCacheErrorHandler:</span><span class="o">:</span><span class="k">new</span><span class="o">);</span>
				<span class="k">this</span><span class="o">.</span><span class="na">keyGenerator</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SingletonSupplier</span><span class="o">&lt;&gt;(</span><span class="n">keyGenerator</span><span class="o">,</span> <span class="nl">SimpleKeyGenerator:</span><span class="o">:</span><span class="k">new</span><span class="o">);</span>
				<span class="k">this</span><span class="o">.</span><span class="na">cacheResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SingletonSupplier</span><span class="o">&lt;&gt;(</span><span class="n">cacheResolver</span><span class="o">,</span>
						<span class="o">()</span> <span class="o">-&gt;</span> <span class="nc">SimpleCacheResolver</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">SupplierUtils</span><span class="o">.</span><span class="na">resolve</span><span class="o">(</span><span class="n">cacheManager</span><span class="o">)));</span>
			<span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">CacheAspectSupport</code> 는 <code class="language-plaintext highlighter-rouge">ProxyCachingConfiguration</code>에서 빈으로 등록합니다. <code class="language-plaintext highlighter-rouge">AspectJCachingConfiguration</code>는 앞서 설정 값(<code class="language-plaintext highlighter-rouge">CachingConfigurer</code>)들을 setter injection으로 의존성 주입을 받은 <code class="language-plaintext highlighter-rouge">AbstractCachingConfiguration</code>를 상속받으며, 이 주입받은 값들을 이용해 빈으로 등록하게 됩니다. 해당 코드는 다음과 같으며 등록하는 빈인 <code class="language-plaintext highlighter-rouge">AnnotationCacheAspect</code>는 <code class="language-plaintext highlighter-rouge">CacheAspectSupport</code>를 상속받습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">// package org.springframework.cache.annotation;</span>
<span class="nd">@Configuration</span><span class="o">(</span><span class="n">proxyBeanMethods</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>  
<span class="nd">@Role</span><span class="o">(</span><span class="nc">BeanDefinition</span><span class="o">.</span><span class="na">ROLE_INFRASTRUCTURE</span><span class="o">)</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProxyCachingConfiguration</span> <span class="kd">extends</span> <span class="nc">AbstractCachingConfiguration</span> <span class="o">{</span>

	<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="nc">CacheManagementConfigUtils</span><span class="o">.</span><span class="na">CACHE_ASPECT_BEAN_NAME</span><span class="o">)</span>
	<span class="nd">@Role</span><span class="o">(</span><span class="nc">BeanDefinition</span><span class="o">.</span><span class="na">ROLE_INFRASTRUCTURE</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nc">AnnotationCacheAspect</span> <span class="nf">cacheAspect</span><span class="o">()</span> <span class="o">{</span>
		<span class="nc">AnnotationCacheAspect</span> <span class="n">cacheAspect</span> <span class="o">=</span> <span class="nc">AnnotationCacheAspect</span><span class="o">.</span><span class="na">aspectOf</span><span class="o">();</span>
		<span class="n">cacheAspect</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">errorHandler</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">keyGenerator</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">cacheResolver</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">cacheManager</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">cacheAspect</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span>

<span class="c1">// package org.springframework.cache.aspectj;</span>
<span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnnotationCacheAspect</span> <span class="kd">extends</span> <span class="nc">AbstractCacheAspect</span> <span class="o">{</span>
	 <span class="o">...</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="구현-코드"><span class="mr-2">구현 코드</span><a href="#구현-코드" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>내부 원리를 확인해봤으니 실제 코드를 작성해보겠습니다. 문제 상황은 캐쉬 조회(<code class="language-plaintext highlighter-rouge">CacheGet</code>) 시 SerializationException이 발생하는 경우이기에, 이를 상속받아 원하는 대로 동작하도록 변경하면 다음과 같습니다. <code class="language-plaintext highlighter-rouge">SerializationException</code> 가 발생했을 때 로그만 남기고 예외를 무시하도록 처리했습니다</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomCacheErrorHandler</span> <span class="kd">extends</span> <span class="nc">SimpleCacheErrorHandler</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleCacheGetError</span><span class="o">(</span><span class="nc">RuntimeException</span> <span class="n">exception</span><span class="o">,</span> <span class="nc">Cache</span> <span class="n">cache</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="nc">SerializationException</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Failed to deserialize cache value for key: {}"</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">exception</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">super</span><span class="o">.</span><span class="na">handleCacheGetError</span><span class="o">(</span><span class="n">exception</span><span class="o">,</span> <span class="n">cache</span><span class="o">,</span> <span class="n">key</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>캐시 설정은 다음과 같습니다. 전체 캐시(Spring Boot Cache)에 대한 책임을 <code class="language-plaintext highlighter-rouge">CacheConfig</code>에 두었고 레디스 캐시 설정에 대한 책임을 <code class="language-plaintext highlighter-rouge">RedisCacheConfig</code>에 뒀습니다,</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="nd">@Configuration</span><span class="o">(</span><span class="n">proxyBeanMethods</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<span class="nd">@EnableCaching</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CacheConfig</span> <span class="kd">implements</span> <span class="nc">CachingConfigurer</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">CacheManager</span> <span class="n">redisCacheManager</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="nd">@Bean</span>
    <span class="nd">@Primary</span>
    <span class="kd">public</span> <span class="nc">CacheManager</span> <span class="nf">cacheManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">redisCacheManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">CacheErrorHandler</span> <span class="nf">errorHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">CustomCacheErrorHandler</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="n">proxyBeanMethods</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisCacheConfig</span><span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">CacheManager</span> <span class="nf">redisCacheManager</span><span class="o">(</span><span class="nc">RedisConnectionFactory</span> <span class="n">redisConnectionFactory</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">RedisCacheManager</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="n">redisConnectionFactory</span><span class="o">)</span>
            <span class="o">.</span><span class="na">cacheDefaults</span><span class="o">(</span><span class="n">cacheConfiguration</span><span class="o">())</span>
            <span class="o">.</span><span class="na">withCacheConfiguration</span><span class="o">(</span><span class="no">PRODUCT_CACHE</span><span class="o">,</span>
                <span class="nc">RedisCacheConfiguration</span><span class="o">.</span><span class="na">defaultCacheConfig</span><span class="o">().</span><span class="na">entryTtl</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMinutes</span><span class="o">(</span><span class="mi">10</span><span class="o">)))</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">RedisCacheConfiguration</span> <span class="nf">cacheConfiguration</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">RedisCacheConfiguration</span><span class="o">.</span><span class="na">defaultCacheConfig</span><span class="o">()</span>
            <span class="o">.</span><span class="na">entryTtl</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMinutes</span><span class="o">(</span><span class="mi">60</span><span class="o">))</span>
            <span class="o">.</span><span class="na">disableCachingNullValues</span><span class="o">()</span>
            <span class="o">.</span><span class="na">serializeKeysWith</span><span class="o">(</span><span class="nc">SerializationPair</span><span class="o">.</span><span class="na">fromSerializer</span><span class="o">(</span><span class="k">new</span> <span class="nc">StringRedisSerializer</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">serializeValuesWith</span><span class="o">(</span><span class="nc">SerializationPair</span><span class="o">.</span><span class="na">fromSerializer</span><span class="o">(</span><span class="k">new</span> <span class="nc">GenericJackson2JsonRedisSerializer</span><span class="o">()));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CacheName</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">PRODUCT_CACHE</span> <span class="o">=</span> <span class="s">"productCache_V2"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>캐시를 이용해 비즈니스 로직을 처리하는 서비스 코드는 다음과 같습니다. <code class="language-plaintext highlighter-rouge">@Cacheable</code>을 이용해 해당 key에 대한 값이 캐시에 존재하면 캐시에서 조회하고 그렇지 않으면 캐시를 등록하는 코드입니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="nd">@Service</span>
<span class="nd">@Slf4j</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ProductRepository</span> <span class="n">productRepository</span><span class="o">;</span>

    <span class="nd">@PostConstruct</span>
    <span class="kt">void</span> <span class="nf">initProducts</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">productRepository</span><span class="o">.</span><span class="na">saveAll</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                        <span class="k">new</span> <span class="nf">Product</span><span class="o">(</span><span class="s">"box"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="mi">1000</span><span class="o">)),</span>
                        <span class="k">new</span> <span class="nf">Product</span><span class="o">(</span><span class="s">"snack"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="mi">4000</span><span class="o">)),</span>
                        <span class="k">new</span> <span class="nf">Product</span><span class="o">(</span><span class="s">"chicken"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BigDecimal</span><span class="o">(</span><span class="mi">20000</span><span class="o">))</span>
                <span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">cacheNames</span> <span class="o">=</span> <span class="no">PRODUCT_CACHE</span><span class="o">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s">"'top10'"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ProductResponse</span><span class="o">&gt;</span> <span class="nf">getTenProduct</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"NO CACHE - find top 10 products from DB"</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">ProductResponse</span><span class="o">.</span><span class="na">listOf</span><span class="o">(</span><span class="n">productRepository</span><span class="o">.</span><span class="na">findTop10By</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@CacheEvict</span><span class="o">(</span><span class="n">cacheNames</span> <span class="o">=</span> <span class="no">PRODUCT_CACHE</span><span class="o">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s">"'top10'"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">evict</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Cache Evicted"</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/api/v1"</span><span class="o">)</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ProductService</span> <span class="n">productService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/products/top10"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">getTop10Products</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">productService</span><span class="o">.</span><span class="na">getTenProduct</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위의 <code class="language-plaintext highlighter-rouge">CustomCacheErrorHandler</code>와 <code class="language-plaintext highlighter-rouge">CachingConfigurer</code> 를 설정해주지 않은 상태에서<code class="language-plaintext highlighter-rouge">api.ProductResponse</code> 패키지 경로로 해당 객체의 캐시를 만들고 <code class="language-plaintext highlighter-rouge">api.v2.ProductResponse</code> 패키지로 옮긴 다음에 동일한 키로 조회를 하면 <code class="language-plaintext highlighter-rouge">SerializationException</code>이 발생하면서 ExceptionHandler를 통한 에러 응답이 오게됩니다.</p><p>위의 코드를 적용하고 동일한 상황을 재현해보면 warn 로그가 찍히고 응답이 정상적으로 가는 것을 볼 수 있습니다. 이로 인해 새로운 버전의 클래스로 캐시를 덮어쓰게 되면서 이후 요청에 대해서는 정상적으로 캐시를 조회하게 됩니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="mi">2024</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">31</span> <span class="mi">20</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mf">28.248</span>  <span class="no">WARN</span> <span class="mi">43092</span> <span class="o">---</span> <span class="o">[</span><span class="n">nio</span><span class="o">-</span><span class="mi">8080</span><span class="o">-</span><span class="n">exec</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="n">c</span><span class="o">.</span><span class="na">e</span><span class="o">.</span><span class="na">r</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">CustomCacheErrorHandler</span>     <span class="o">:</span> <span class="nc">Failed</span> <span class="n">to</span> <span class="n">deserialize</span> <span class="n">cache</span> <span class="n">value</span> <span class="k">for</span> <span class="nl">key:</span> <span class="n">top10</span>

<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">serializer</span><span class="o">.</span><span class="na">SerializationException</span><span class="o">:</span> <span class="nc">Cannot</span> <span class="n">deserialize</span><span class="o">;</span> <span class="n">nested</span> <span class="n">exception</span> <span class="n">is</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">serializer</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">SerializationFailedException</span><span class="o">:</span> <span class="nc">Failed</span> <span class="n">to</span> <span class="n">deserialize</span> <span class="n">payload</span><span class="o">.</span> <span class="nc">Is</span> <span class="n">the</span> <span class="kt">byte</span> <span class="n">array</span> <span class="n">a</span> <span class="n">result</span> <span class="n">of</span> <span class="n">corresponding</span> <span class="n">serialization</span> <span class="k">for</span> <span class="nc">DefaultDeserializer</span><span class="o">?;</span> <span class="n">nested</span> <span class="n">exception</span> <span class="n">is</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">NestedIOException</span><span class="o">:</span> <span class="nc">Failed</span> <span class="n">to</span> <span class="n">deserialize</span> <span class="n">object</span> <span class="n">type</span><span class="o">;</span> <span class="n">nested</span> <span class="n">exception</span> <span class="n">is</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ClassNotFoundException</span><span class="o">:</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">redisinactions</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">v2</span><span class="o">.</span><span class="na">ProductResponse</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">serializer</span><span class="o">.</span><span class="na">JdkSerializationRedisSerializer</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="nc">JdkSerializationRedisSerializer</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">84</span><span class="o">)</span> <span class="o">~[</span><span class="n">spring</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">redis</span><span class="o">-</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="na">jar</span><span class="o">:</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">2</span><span class="o">]</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">serializer</span><span class="o">.</span><span class="na">DefaultRedisElementReader</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="nc">DefaultRedisElementReader</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">49</span><span class="o">)</span> <span class="o">~[</span><span class="n">spring</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">redis</span><span class="o">-</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="na">jar</span><span class="o">:</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">2</span><span class="o">]</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">serializer</span><span class="o">.</span><span class="na">RedisSerializationContext</span><span class="n">$SerializationPair</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="nc">RedisSerializationContext</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">272</span><span class="o">)</span> <span class="o">~[</span><span class="n">spring</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">redis</span><span class="o">-</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="na">jar</span><span class="o">:</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">2</span><span class="o">]</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">RedisCache</span><span class="o">.</span><span class="na">deserializeCacheValue</span><span class="o">(</span><span class="nc">RedisCache</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">298</span><span class="o">)</span> <span class="o">~[</span><span class="n">spring</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">redis</span><span class="o">-</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="na">jar</span><span class="o">:</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">2</span><span class="o">]</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">redis</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">RedisCache</span><span class="o">.</span><span class="na">lookup</span><span class="o">(</span><span class="nc">RedisCache</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">95</span><span class="o">)</span> <span class="o">~[</span><span class="n">spring</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">redis</span><span class="o">-</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="na">jar</span><span class="o">:</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">2</span><span class="o">]</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">AbstractValueAdaptingCache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">AbstractValueAdaptingCache</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">58</span><span class="o">)</span> <span class="o">~[</span><span class="n">spring</span><span class="o">-</span><span class="n">context</span><span class="o">-</span><span class="mf">5.3</span><span class="o">.</span><span class="mi">22</span><span class="o">.</span><span class="na">jar</span><span class="o">:</span><span class="mf">5.3</span><span class="o">.</span><span class="mi">22</span><span class="o">]</span>
	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">interceptor</span><span class="o">.</span><span class="na">AbstractCacheInvoker</span><span class="o">.</span><span class="na">doGet</span><span class="o">(</span><span class="nc">AbstractCacheInvoker</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">73</span><span class="o">)</span> <span class="o">~[</span><span class="n">spring</span><span class="o">-</span><span class="n">context</span><span class="o">-</span><span class="mf">5.3</span><span class="o">.</span><span class="mi">22</span><span class="o">.</span><span class="na">jar</span><span class="o">:</span><span class="mf">5.3</span><span class="o">.</span><span class="mi">22</span><span class="o">]</span>
	<span class="o">...</span>
<span class="mi">2024</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">31</span> <span class="mi">20</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mf">28.250</span>  <span class="no">WARN</span> <span class="mi">43092</span> <span class="o">---</span> <span class="o">[</span><span class="n">nio</span><span class="o">-</span><span class="mi">8080</span><span class="o">-</span><span class="n">exec</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="n">c</span><span class="o">.</span><span class="na">e</span><span class="o">.</span><span class="na">redisinactions</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">ProductService</span>    <span class="o">:</span> <span class="no">NO</span> <span class="no">CACHE</span> <span class="o">-</span> <span class="n">find</span> <span class="n">top</span> <span class="mi">10</span> <span class="n">products</span> <span class="n">from</span> <span class="no">DB</span>
<span class="mi">2024</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">31</span> <span class="mi">20</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mf">28.298</span> <span class="no">DEBUG</span> <span class="mi">43092</span> <span class="o">---</span> <span class="o">[</span><span class="n">nio</span><span class="o">-</span><span class="mi">8080</span><span class="o">-</span><span class="n">exec</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">SQL</span>                        <span class="o">:</span> <span class="n">select</span> <span class="n">product0_</span><span class="o">.</span><span class="na">id</span> <span class="n">as</span> <span class="n">id1_0_</span><span class="o">,</span> <span class="n">product0_</span><span class="o">.</span><span class="na">description</span> <span class="n">as</span> <span class="n">descript2_0_</span><span class="o">,</span> <span class="n">product0_</span><span class="o">.</span><span class="na">price</span> <span class="n">as</span> <span class="n">price3_0_</span><span class="o">,</span> <span class="n">product0_</span><span class="o">.</span><span class="na">quantity</span> <span class="n">as</span> <span class="n">quantity4_0_</span> <span class="n">from</span> <span class="n">product</span> <span class="n">product0_</span> <span class="n">limit</span> <span class="o">?</span>
<span class="nl">Hibernate:</span> <span class="n">select</span> <span class="n">product0_</span><span class="o">.</span><span class="na">id</span> <span class="n">as</span> <span class="n">id1_0_</span><span class="o">,</span> <span class="n">product0_</span><span class="o">.</span><span class="na">description</span> <span class="n">as</span> <span class="n">descript2_0_</span><span class="o">,</span> <span class="n">product0_</span><span class="o">.</span><span class="na">price</span> <span class="n">as</span> <span class="n">price3_0_</span><span class="o">,</span> <span class="n">product0_</span><span class="o">.</span><span class="na">quantity</span> <span class="n">as</span> <span class="n">quantity4_0_</span> <span class="n">from</span> <span class="n">product</span> <span class="n">product0_</span> <span class="n">limit</span> <span class="o">?</span>
<span class="mi">2024</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">31</span> <span class="mi">20</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mf">28.311</span> <span class="no">DEBUG</span> <span class="mi">43092</span> <span class="o">---</span> <span class="o">[</span><span class="n">nio</span><span class="o">-</span><span class="mi">8080</span><span class="o">-</span><span class="n">exec</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="n">o</span><span class="o">.</span><span class="na">s</span><span class="o">.</span><span class="na">w</span><span class="o">.</span><span class="na">s</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">HttpEntityMethodProcessor</span>  <span class="o">:</span> <span class="nc">Using</span> <span class="err">'</span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="err">'</span><span class="o">,</span> <span class="n">given</span> <span class="o">[*</span><span class="cm">/*] and supported [application/json, application/*+json, application/json, application/*+json]
2024-03-31 20:13:28.311 DEBUG 43092 --- [nio-8080-exec-1] o.s.w.s.m.m.a.HttpEntityMethodProcessor  : Writing [[com.example.redisinactions.api.ProductResponse@3c54979a, com.example.redisinactions.api.ProductResp (truncated)...]
2024-03-31 20:13:28.317 DEBUG 43092 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed 200 OK
2024-03-31 20:14:47.332 DEBUG 43092 --- [nio-8080-exec-3] o.s.web.servlet.DispatcherServlet        : GET "/api/v1/products/top10", parameters={}
2024-03-31 20:14:47.332 DEBUG 43092 --- [nio-8080-exec-3] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.example.redisinactions.api.ProductController#getTop10Products()
2024-03-31 20:14:47.336 DEBUG 43092 --- [nio-8080-exec-3] o.s.w.s.m.m.a.HttpEntityMethodProcessor  : Using 'application/json', given [*/</span><span class="o">*]</span> <span class="n">and</span> <span class="n">supported</span> <span class="o">[</span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="o">,</span> <span class="n">application</span><span class="o">/*+</span><span class="n">json</span><span class="o">,</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="o">,</span> <span class="n">application</span><span class="o">/*+</span><span class="n">json</span><span class="o">]</span>
<span class="mi">2024</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">31</span> <span class="mi">20</span><span class="o">:</span><span class="mi">14</span><span class="o">:</span><span class="mf">47.336</span> <span class="no">DEBUG</span> <span class="mi">43092</span> <span class="o">---</span> <span class="o">[</span><span class="n">nio</span><span class="o">-</span><span class="mi">8080</span><span class="o">-</span><span class="n">exec</span><span class="o">-</span><span class="mi">3</span><span class="o">]</span> <span class="n">o</span><span class="o">.</span><span class="na">s</span><span class="o">.</span><span class="na">w</span><span class="o">.</span><span class="na">s</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">HttpEntityMethodProcessor</span>  <span class="o">:</span> <span class="nc">Writing</span> <span class="o">[[</span><span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">redisinactions</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">ProductResponse</span><span class="err">@</span><span class="mi">39</span><span class="n">bba9c2</span><span class="o">,</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">redisinactions</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">ProductResp</span> <span class="o">(</span><span class="n">truncated</span><span class="o">)...]</span>
<span class="mi">2024</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">31</span> <span class="mi">20</span><span class="o">:</span><span class="mi">14</span><span class="o">:</span><span class="mf">47.337</span> <span class="no">DEBUG</span> <span class="mi">43092</span> <span class="o">---</span> <span class="o">[</span><span class="n">nio</span><span class="o">-</span><span class="mi">8080</span><span class="o">-</span><span class="n">exec</span><span class="o">-</span><span class="mi">3</span><span class="o">]</span> <span class="n">o</span><span class="o">.</span><span class="na">s</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">DispatcherServlet</span>        <span class="o">:</span> <span class="nc">Completed</span> <span class="mi">200</span> <span class="no">OK</span>

</pre></table></code></div></div><p>하지만 소개한 해결 방법은 배포 전략에 따라 문제가 될 수 있습니다. 단번에 배포를 변경하는 Blue-Green 전략의 경우 롤백하지 않는다면 새로 배포된 인스턴스는 새로운 캐시만 바라보게 되므로 문제가 되지 않습니다.</p><p>하지만 만약 캐시에 해당하는 클래스의 패키지를 변경하고 카나리 배포를 진행하고 구 버전과 신 버전의 인스턴스가 동시에 떠있는 상태라면 CacheName은 동일하기에 새로운 버전의 인스턴스(<code class="language-plaintext highlighter-rouge">api.v2.ProductResponse</code>)와 구 버전의 인스턴스(<code class="language-plaintext highlighter-rouge">api.ProductResponse</code>)에 대한 캐시 쓰기가 반복될 수 있습니다. 이 경우 트래픽이 많은 서비스라면 캐시 저장소에 대한 부하가 커질 수 있다는 단점이 존재합니다. 따라서 카나리의 경우는 이전에 제시한 해결책인 새로운 CacheName을 가진 캐시를 새로 만드는게 더 안전한 방법일 수 있습니다. 따라서 본 글의 목적인 상황에 맞게 캐시의 에러 핸들링 전략을 취하면 적절할 것 같습니다.</p><p>코드는 다음 링크에서 확인해볼 수 있습니다.</p><ul><li><a href="https://github.com/ChoiEungi/redis-in-actions">https://github.com/ChoiEungi/redis-in-actions</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/development/'>Development</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring-boot/" class="post-tag no-text-decoration" >Spring Boot</a> <a href="/tags/redis/" class="post-tag no-text-decoration" >Redis</a> <a href="/tags/caching/" class="post-tag no-text-decoration" >Caching</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Spring Boot에서 CacheManager를 에러 핸들링하는 방법 - Ruggy Blog&amp;url=https://choieungi.github.io/posts/spring-boot-cahce-error-handling/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Spring Boot에서 CacheManager를 에러 핸들링하는 방법 - Ruggy Blog&amp;u=https://choieungi.github.io/posts/spring-boot-cahce-error-handling/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://choieungi.github.io/posts/spring-boot-cahce-error-handling/&amp;text=Spring Boot에서 CacheManager를 에러 핸들링하는 방법 - Ruggy Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/spring-boot-cahce-error-handling/">Spring Boot에서 CacheManager를 에러 핸들링하는 방법</a><li><a href="/posts/spring-cloud-refresh/">분산 시스템 환경에서 Spring Cloud Bus 없이 Spring Cloud Config 프로퍼티 Refresh하는 방법</a><li><a href="/posts/spring-redis-distributed-lock/">Spring MVC에서 redisson으로 분산락을 구현하는 방법들</a><li><a href="/posts/spring-redis-cache-serialization-exception/">Spring Boot에서 Redis @Cacheable을 사용할 때 주의할 점</a><li><a href="/posts/querydsl-connection-leak/">querydsl의 transform 메서드에서 발생하는 connection leak 현상</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spring-boot/">Spring Boot</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/thinking/">Thinking</a> <a class="post-tag" href="/tags/redis/">Redis</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/development/">Development</a> <a class="post-tag" href="/tags/gist-%EC%B2%AD%EC%9B%90/">GIST 청원</a> <a class="post-tag" href="/tags/git/">Git</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/spring/">Spring</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spring-redis-cache-serialization-exception/"><div class="card-body"> <em class="timeago small" data-ts="1702218600" > 2023-12-10 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring Boot에서 Redis @Cacheable을 사용할 때 주의할 점</h3><div class="text-muted small"><p> 사내에서 패키지 구조 변경 작업을 하고 배포를 했는데 갑자기 특정 API에서 transaction silently rolled back이 발생했었습니다. 관련해서 확인해보니 DB조회 값을 Dto 객체로 변환해 캐싱한 값을 역직렬화하는 과정에서 문제가 발생했었습니다. 해당 캐시는 월마다 한번씩 바뀌는 주기를 갖는 값으로, 조회가 많은 비율을 차지합니다...</p></div></div></a></div><div class="card"> <a href="/posts/spring-redis-distributed-lock/"><div class="card-body"> <em class="timeago small" data-ts="1703427180" > 2023-12-24 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring MVC에서 redisson으로 분산락을 구현하는 방법들</h3><div class="text-muted small"><p> 멀티 인스턴스 환경에서 동시성을 해결하는 방법으로 Redis의 이벤트 루프 기반 싱글스레드 특성을 이용해 분산락을 사용해 쉽게 해결할 수 있습니다. 동시 호출은 DB 데이터의 정합이 깨지거나 메시지 이벤트의 중복 발행 등 예상치 못한 동작으로 이어지는 경우가 많아 해결해야 하는 경우가 빈번합니다. 분산락은 동시성을 제어하기 위한 부가 기능으로 비즈니...</p></div></div></a></div><div class="card"> <a href="/posts/gijol-%ED%9A%8C%EA%B3%A0/"><div class="card-body"> <em class="timeago small" data-ts="1653990180" > 2022-05-31 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Project] Gijol MVP 런칭 회고</h3><div class="text-muted small"><p> 배포 링크: Gijol BE 배경 GIST 청원 프로젝트를 진행하면서 크게 제품의 코드 작성법과 테스트, Operation, Git flow 등을 배울 수 있었다. 이를 청원팀의 팀원으로서 배웠던 점이 많은데 과연 이 배운 것들을 내가 스스로 해나갈 수 있을지에 대해서 의문이 들었다. 이에 대한 중요성과 필요성이 너무나도 중요하게 느껴졌기에...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/spring-cloud-refresh/" class="btn btn-outline-primary" prompt="Older"><p>분산 시스템 환경에서 Spring Cloud Bus 없이 Spring Cloud Config 프로퍼티 Refresh하는 방법</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/Choieungi">Eungi, Choi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spring-boot/">Spring Boot</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/thinking/">Thinking</a> <a class="post-tag" href="/tags/redis/">Redis</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/development/">Development</a> <a class="post-tag" href="/tags/gist-%EC%B2%AD%EC%9B%90/">GIST 청원</a> <a class="post-tag" href="/tags/git/">Git</a> <a class="post-tag" href="/tags/mysql/">MySQL</a> <a class="post-tag" href="/tags/spring/">Spring</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-3R6NSQ6EMQ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-3R6NSQ6EMQ'); }); </script>
